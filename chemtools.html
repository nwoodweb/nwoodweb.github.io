<head>

<meta charset = "UTF-8">
<title>GSOC 2021 - Visualization Methods for QCDevs - Nathan Wood </title>
<link rel = "stylesheet"
type = "text/css"
href = "style.css" />
</head>


<body>
<center>
  <h1 id="google-summer-of-code-2021-exploring-alternative-visualizations-for-openchem-qcdevs">Google Summer of Code 2021: Exploring Alternative Visualizations for OpenChem QCDevs</h1>
  <b>
  <p>Nathan Wood, Year 4 Undergraduate, Microbiology and Cell Science, University of Florida</p>
  <p>This project was prepared under the advisory of Dr. Farnaz Heidar-Zadeh, Dr. Paul Ayers, and Dr. Esteban Vohringer-Martinez</p>
    <p>With additional assistance from Gabriella Sánchez-Dìaz and Ali Tehrani </p>
  <h2 id="note-submitted-work">Submitted Work</h2>
  </b> 
</center>
<p>All work pertaining to objectives has been linked within the Results section.</p>
<p>For ease of access, links can also be found below:</p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/esp/chimerax_vis_esp.py">Python Function of ChimeraX Isosurface Visualization</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/annotate_3D/3DimensionAnnotation.ipynb">Jupyter Notebook of 3D Annotation</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/annotate_3D/3DimensionAnnotation.py">Python Script of 3D Annotation</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/annotate_2D/2DAnnotate.ipynb">Jupyter Notebook of 2D Annotation</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/annotate_2D/2DAnnotate.py">Python Script of 2D Annotation</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/plotting/2D_Plotting_Gradient.ipynb">Jupyter Notebook of Both Vector and Scalar Qualities</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/plotting/plotVectorField.py">Python Script of Field Plot</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/plotting/plotScalarContour.py">Python Script of Contour Plot</a></p>
<center>
<h2 id="introduction">Introduction</h2>
</center> 
<p>OpenChem wishes to implement a means of visualizing Chemtools data. Such means include exploring viable alternatives to Visualizing Molecular Dynamics as a visualization platfrom. Further visualization goals include the plotting of gradient vector fields and annotation of molecules. Additionally, ChimeraX, developed by the University of California, San Francisco, was chosen as a general purpose alternative for VMD, with regards to visualizing isosurfaces as well as molecular annotations.</p>
<center>
  <h2 id="goals">Goals</h2>
</center>
<h3 id="visualizing-electrostatic-potential-isosurfaces">Visualizing Electrostatic Potential Isosurfaces</h3>
<p>We wish to examine alternatives to Visualizing Molecular Dynamics (VMD) to visualize isosurfaces of molecules computed by Chemtools. Examples of VMD Alternatives include Avogadro/Avogadro2, ChimeraX, IQMol, JMol/JSMol, and PyMOL.</p>
<h3 id="d-annotation-of-molecules">3D Annotation of Molecules</h3>
<p>We wish to devise a means of taking IOData output, such as electrostatic potential charges, and applying these values as text annotations in a molecule rendered in a three dimensional environment.</p>
<h3 id="d-annotation-of-molecules-1">2D Annotation of Molecules</h3>
<p>We wish to implement a means of not only visualizing a given molecule originating from a Gaussian Checkpoint file (fchk), but also annotating a 2-dimensional representation of this molecule using data from IOData.</p>
<h3 id="plotting-of-vector-and-scalar-qualities-of-molecules">Plotting of Vector and Scalar Qualities of Molecules</h3>
<p>We wish to develop a means of visualizing the computation of both scalar and vector qualities of molecules.</p>
<h3 id="molecular-graphs-of-bond-and-ring-critical-points">Molecular Graphs of Bond and Ring Critical Points</h3>
<p>We wish to implement a means of visualizing the bond and ring critical points of a given molecule.</p>
  <center>
    <h2 id="results">Results</h2>
  </center>
<h3 id="visualizing-electrostatic-potential-isosurfaces-1">Visualizing Electrostatic Potential Isosurfaces</h3>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/esp/chimerax_vis_esp.py">Python/ChimeraX Script to Visualize Isosurfaces</a></p>
<p>A script, consolidated as function <code>print_chimerax_isosurfaces</code>, has been written, and accomplishes the following actions within the ChimeraX Environment:</p>
<ul>
<li>Open our surfaces file, generically named <code>*_rho.cube</code></li>
<li>Open our map file, which allows us to color the surfaces, generically named <code>*_esp.cube</code></li>
<li>Set to isosurface levels to visualize</li>
<li>Set the lighting, shadows, surface material appearance (ie dull or shiny), and representation (ie sufraces or meshes)</li>
<li>Set a color palette, both custom or built into ChimeraX</li>
<li>Set the minimum <code>scalemin</code> and maximum <code>scalemax</code> value range for colorizng the surfaces, or allow ChimeraX to determine the most suitable range using the string <code>'compute'</code> for both the <code>scalemin</code> and <code>scalemax</code> parameters within the script</li>
</ul>
  <figure>
  <center>
<img src="espIso.gif" alt="ChimeraX ESP Isosurface Visualization 2,6-Dichloropyridine" width="400"/>
    <figcaption>ChimeraX Visualization of Electrostatic Potential Isosurfaces Belonging to 2,6-dichloropyridine, Using the ChimeraX Color Palette<code> rainbow</code></figcaption>
</center>
  </figure>
<h3 id="d-annotation-of-molecules-2">3D Annotation of Molecules</h3>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/annotate_3D/3DimensionAnnotation.ipynb">Jupyter Notebook of 3D Annotation</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/annotate_3D/3DimensionAnnotation.py">Python Script of 3D Annotation</a></p>
<p>IOData can output to Protein Data Bank (PDB) files, a text file that enumerates monomer and a atomic data, such as element, XYZ cartesian coordinates, and B Factor, which has historically been used to quantify flexibility and freedom of motion in computational protein-ligand docking. Originally, ChimeraX’s Attribute Files, which allow a tab separated table enumerating characteristics per unit, was conceived as a means of annotating molecules as it was not considered to be a &quot;hack&quot; and could allow multiple different annotations could be performed without overwriting our PDB. However, this was abandoned due to the complexity of assigning IOData values to an format ChimeraX finds accessible.<br />
</p>
<p>IOData possesses a feature known as <code>extra</code>, which allows writing in B Factors when an intermediate PDB file is opened using IOData function <code>load_one</code>, which can then be written to a finalized PDB file to be loaded into ChimeraX. Once loaded, ChimeraX can visualize the B Factor using its labeling utilities.</p>
<figure>
  <center>
<img src="3dannotate.png" alt="3D Annotation with ESP Charges of 2,6-dichloropyridine" width="300"/>
    <figcaption>3D Annotation using Electrostatic Potential Charges, 2,6-dichloropyridine</figcaption>
</center>
  </figure>
<h3 id="d-annotation-of-molecules-3">2D Annotation of Molecules</h3>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/annotate_2D/2DAnnotate.ipynb">Jupyter Notebook of 2D Annotation</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/annotate_2D/2DAnnotate.py">Python Script of 2D Annotation</a></p>
<p>IOData is used to dump an XYZ and PDB files from the original Gaussian Checkpoint (fchk) file. XYZ files are capable of being converted to accurate SMILES strings via the Chemml utilities, however, the order of the atoms being enumerated differs from that of IOData, making it non-trivial to assign charges resulting from IOData’s <code>atcharges</code> call. On the other hand, PDB Files maintain the atomic order as IOData, however, RDKit cannot visualize any pi bonds from the PDB. This is due to the fact that PDB Files store pi bond data based on the distance between atoms in cartesian space, whereas RDKit prefers bonds to be explicitly detailed.</p>
<p>To address both issues, we can first correct the geometry of the PDB by using RDKit’s <code>Compute2DCoords</code> and then force the PDB to assume the visualization stile of the afforementioned SMILES string using <code>AssignBondOrdersFromTemplate</code>. Afterwards, the charges from IOData can be assigned iteratively.</p>
<figure>
  <center>
<img src="test11.png" alt="2D Annotation with ESP Charges of 2,6-dichloropyridine" width="300"/>
    <figcaption>2D Annotation with Electrostatic Potential Charges, 2,6-dichloropyridine</figcaption>
</center>
  </figure> 
<h3 id="plotting-of-vector-and-scalar-qualities-of-molecules-1">Plotting of Vector and Scalar Qualities of Molecules</h3>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/plotting/2D_Plotting_Gradient.ipynb">Jupyter Notebook of Both Vector and Scalar Qualities</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/plotting/plotVectorField.py">Python Script of Field Plot</a></p>
<p><a href="https://github.com/nwoodweb/chemtools/blob/master/examples/plotting/plotScalarContour.py">Python Script of Contour Plot</a></p>
<p>A Jupyter Notebook and function <code>plotVectorFieldOverPlane</code> were made that is capable of plotting gradient vector fields. This was performed by:</p>
<ul>
<li>Using 3D rotate and scale operation against an affine plane, and then normalize to plot vector qualities against.</li>
<li>Assigning our <code>vectorFunc</code> as as the vector quality we want to explore, in this case <code>mol.compute_gradient()</code></li>
<li>Projecting our vector quality against the rotated affine plane</li>
<li>Visualizing the vector quality as a gradient vector field &quot;Quiver Plot&quot;</li>
</ul>
  <figure>
<center>
  <p><img src="dichlorgradient.png" alt="Gradient Vector Field of 2,6-Dichloropyridine" width="300"/></p>
  <figcaption>Gradient Vector Field Plot of 2,6-dichloropyridine</figcaption>
</center>
  </figure>
<p>To plot a scalar quality, in this case electron density, we want to</p>
<ul>
<li>Rotate an affine plane and normalize to plot scalar quality against</li>
<li>Assign our <code>scalarFunc</code> which is a scalar quality of a molecule, in this case, electrostatic density</li>
<li>Visualizing the scalar quality as a contour plot, with our <code>scalarFunc</code> representing the level curves</li>
</ul>
<center>
  <figure>
<p><img src="contour.png" alt="Contour Plot for Electron Densityof 2,6-Dichloropyridine" width="300"/></p>
    <figcaption>Contour Plot of Electron Densities in 2,6-dichloropyridine</figcaption>
</center>
  </figure>
<center><h2 id="post-mortem">Post Mortem</h2></center>
<h3 id="administrative">Administrative</h3>
<p>While debug and deprecated code has been removed, parameters for functions need to be explicitly detailed.</p>
<h3 id="discrepancies-between-vmd-and-chimerax">Discrepancies between VMD and ChimeraX</h3>
<p>There is a discrepancy between appropriate values to display isosurface levels between both ChimeraX and VMD. For the example 2,6-dichloropyridine, the previous VMD example recommends setting <code>isoSurf</code> to .003 (left), however, in ChimeraX, this will produce a noticeable uncolored void that can be corrected when setting <code>isoSurf</code> to .005 (right).</p>
<figure>
  <center>
    <p><img src="vmdfail.png" alt="isoSurf=.003" width="200" /> <img src="vmdcorrect.png" alt="AisoSurf=.005" width="200" /></p>
    <figcaption><code>isoSurf</code> value <code> .003</code>(left) yields an faulty visualization, <code>isoSurf</code> value <code> .005</code> corrects this</figcaption>
  </center>
  </figure>
<h3 id="molecular-graphs">Molecular Graphs</h3>
<p>The original goal of visualizing molecular graphs detailing the critical points of bonds and ring structures was not fulfilled.</p>
<center><h2 id="moving-forward">Moving Forward</h2></center>
<h3 id="administrative-1">Administrative</h3>
<ol type="1">
<li>Code that has been consolidated into functions should have a more detailed explanation of use and parameters. Once finalized, the current fork should then be merged with <a href="https://github.com/theochem/chemtools">theochem/chemtools main branch</a></li>
<li>Future GSOC internships should make further use of correspondence methods such as Email, Github threads, Slack, and Zoom.</li>
</ol>
<h3 id="converting-iodata-output-into-chemical-json">Converting IOData Output into Chemical JSON</h3>
<p>In order to improve interoperability with Avogadro2, it will be necessary to be able to output IOData and Chemtools data into a &quot;Chemical JSON&quot; a form of JSON file that outlines chemical information such as bonds, atoms, as well as charge and molecular/atomic orbital data. While the formatting of basic data such as bonds and atoms is nontrivial, considerable work will have to be done to correctly format quantum chemistry data.</p>
<h3 id="chimerax">Expanded ChimeraX Functionality and Avogadro2 Interoperability</h3>
  <p>Much like VMD and PyMOL, ChimeraX is a versatile visualization tool for chemical output files, and its future use within Chemtools should be explored.</p>
  <p>Furthermore, Avogadro2 is a OpenChem project in development that also offers visualization capabilities that are worthy of further exploration</p>
  <h3 id="molecular-graphs-1">Molecular Graphs</h3>
<p>There remains the need to implement a means to visualize bond and ring critical points.</p>
<center><h2 id="special-thanks">Special Thanks</h2></center>
<p>I would like to extend great thanks to the following individuals for assisting and granting me flexibility:</p>
<ul>
<li>Farnaz Heidar Zadeh, Professor, Queens University</li>
<li>Paul Ayers, Professor, McMaster University</li>
<li>Esteban Vohringer Martinez, Professor, Universidad de Concepciòn</li>
<li>Toon Vestraelen, Professor, Ghent University</li>
<li>Gabriella Sánchez-Dìaz, McMaster University</li>
<li>Ali Tehrani, McMaster University</li>
<li>Geoff Hutchinson, Avogadro2 Lead</li>
<li>Elaine Meng, PhD, ChimeraX Development Team, University of California San Francisco</li>
<li>Anthony Schaefer, PhD, ChimeraX Development Team, University of California San Francisco</li>
</ul>
</body> 
